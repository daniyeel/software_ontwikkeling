<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_stm32__ub__vga__screen_8h_source" xml:lang="en-US">
<title>stm32_ub_vga_screen.h</title>
<indexterm><primary>CUBE_IDE/VGA/Core/Inc/stm32_ub_vga_screen.h</primary></indexterm>
<programlisting linenumbering="unnumbered">1 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
2 <emphasis role="comment">//&#32;File&#32;&#32;&#32;&#32;&#32;:&#32;stm32_ub_vga_screen.h</emphasis>
3 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
4 
5 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
6 <emphasis role="preprocessor">#ifndef&#32;__STM32F4_UB_VGA_SCREEN_H</emphasis>
7 <emphasis role="preprocessor">#define&#32;__STM32F4_UB_VGA_SCREEN_H</emphasis>
8 
9 
10 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
11 <emphasis role="comment">//&#32;Includes</emphasis>
12 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
13 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_stm32f4xx_8h">stm32f4xx.h</link>&quot;</emphasis>
14 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_stm32f4xx__gpio_8h">stm32f4xx_gpio.h</link>&quot;</emphasis>
15 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_stm32f4xx__rcc_8h">stm32f4xx_rcc.h</link>&quot;</emphasis>
16 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_stm32f4xx__tim_8h">stm32f4xx_tim.h</link>&quot;</emphasis>
17 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_misc_8h">misc.h</link>&quot;</emphasis>
18 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_stm32f4xx__dma_8h">stm32f4xx_dma.h</link>&quot;</emphasis>
19 
20 
21 
22 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
23 <emphasis role="comment">//&#32;color&#32;designation</emphasis>
24 <emphasis role="comment">//&#32;8bit&#32;color&#32;(R3G3B2)</emphasis>
25 <emphasis role="comment">//&#32;Red&#32;&#32;&#32;(3bit)&#32;-&gt;&#32;Bit7-Bit5</emphasis>
26 <emphasis role="comment">//&#32;Green&#32;(3bit)&#32;-&gt;&#32;Bit4-Bit2</emphasis>
27 <emphasis role="comment">//&#32;Blue&#32;&#32;(2bit)&#32;-&gt;&#32;Bit1-Bit0</emphasis>
28 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
29 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_BLACK&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x00</emphasis>
30 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_BLUE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x2B</emphasis>
31 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_GREEN&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x1C</emphasis>
32 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_RED&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0</emphasis>
33 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_WHITE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xFF</emphasis>
34 
35 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_CYAN&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x1F</emphasis>
36 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_MAGENTA&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE3</emphasis>
37 <emphasis role="preprocessor">#define&#32;&#32;VGA_COL_YELLOW&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xFC</emphasis>
38 
39 <emphasis role="preprocessor">#define&#32;VGA_COL_PINK&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xEE</emphasis>
40 <emphasis role="preprocessor">#define&#32;VGA_COL_LIGHTBLUE&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x53&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">//&#32;Extra&#32;colors&#32;(still&#32;needs&#32;a&#32;correct&#32;val</emphasis>
41 <emphasis role="preprocessor">#define&#32;VGA_COL_LIGHTGREEN&#32;&#32;&#32;&#32;&#32;&#32;0x7D</emphasis>
42 <emphasis role="preprocessor">#define&#32;VGA_COL_LIGHTCYAN&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x9F</emphasis>
43 <emphasis role="preprocessor">#define&#32;VGA_COL_LIGHTRED&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xED</emphasis>
44 <emphasis role="preprocessor">#define&#32;VGA_COL_LIGHTMAGENTA&#32;&#32;&#32;&#32;0xEF</emphasis>
45 <emphasis role="preprocessor">#define&#32;VGA_COL_BROWN&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x44</emphasis>
46 <emphasis role="preprocessor">#define&#32;VGA_COL_GRAY&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x6D</emphasis>
47 
48 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
49 <emphasis role="comment">//&#32;define&#32;the&#32;VGA_display</emphasis>
50 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
51 <emphasis role="preprocessor">#define&#32;VGA_DISPLAY_X&#32;&#32;&#32;320</emphasis>
52 <emphasis role="preprocessor">#define&#32;VGA_DISPLAY_Y&#32;&#32;&#32;240</emphasis>
53 
54 
55 
56 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
57 <emphasis role="comment">//&#32;VGA&#32;Structure</emphasis>
58 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
59 <emphasis role="keyword">typedef</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis>{
60 &#32;&#32;uint16_t&#32;hsync_cnt;&#32;&#32;&#32;<emphasis role="comment">//&#32;counter</emphasis>
61 &#32;&#32;uint32_t&#32;start_adr;&#32;&#32;&#32;<emphasis role="comment">//&#32;start_adres</emphasis>
62 &#32;&#32;uint32_t&#32;dma2_cr_reg;&#32;<emphasis role="comment">//&#32;Register&#32;constant&#32;CR-Register</emphasis>
63 }<link linkend="_struct_v_g_a__t">VGA_t</link>;
64 
65 
66 
67 
68 
69 
70 
71 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
72 <emphasis role="comment">//&#32;Timer-1</emphasis>
73 <emphasis role="comment">//&#32;Function&#32;&#32;=&#32;Pixelclock&#32;(Speed&#32;for&#32;&#32;DMA&#32;Transfer)</emphasis>
74 <emphasis role="comment">//</emphasis>
75 <emphasis role="comment">//&#32;basefreq&#32;=&#32;2*APB2&#32;(APB2=84MHz)&#32;=&gt;&#32;TIM_CLK=168MHz</emphasis>
76 <emphasis role="comment">//&#32;Frq&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;168MHz/1/12&#32;=&#32;14MHz</emphasis>
77 <emphasis role="comment">//</emphasis>
78 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
79 <emphasis role="preprocessor">#define&#32;VGA_TIM1_PERIODE&#32;&#32;&#32;&#32;&#32;&#32;11</emphasis>
80 <emphasis role="preprocessor">#define&#32;VGA_TIM1_PRESCALE&#32;&#32;&#32;&#32;&#32;&#32;0</emphasis>
81 
82 
83 
84 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
85 <emphasis role="comment">//&#32;Timer-2</emphasis>
86 <emphasis role="comment">//&#32;Function&#32;&#32;=&#32;CH4&#32;:&#32;HSync-Signal&#32;on&#32;PB11</emphasis>
87 <emphasis role="comment">//&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;CH3&#32;:&#32;Trigger&#32;point&#32;for&#32;DMA&#32;start</emphasis>
88 <emphasis role="comment">//</emphasis>
89 <emphasis role="comment">//&#32;basefreq&#32;=&#32;2*APB1&#32;(APB1=48MHz)&#32;=&gt;&#32;TIM_CLK=84MHz</emphasis>
90 <emphasis role="comment">//&#32;Frq&#32;&#32;&#32;&#32;&#32;&#32;&#32;=&#32;84MHz/1/2668&#32;=&#32;31,48kHz&#32;=&gt;&#32;T&#32;=&#32;31,76us</emphasis>
91 <emphasis role="comment">//&#32;1TIC&#32;&#32;&#32;&#32;&#32;&#32;=&#32;11,90ns</emphasis>
92 <emphasis role="comment">//</emphasis>
93 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
94 <emphasis role="preprocessor">#define&#32;&#32;VGA_TIM2_HSYNC_PERIODE&#32;&#32;&#32;2667</emphasis>
95 <emphasis role="preprocessor">#define&#32;&#32;VGA_TIM2_HSYNC_PRESCALE&#32;&#32;&#32;&#32;&#32;0</emphasis>
96 
97 <emphasis role="preprocessor">#define&#32;&#32;VGA_TIM2_HSYNC_IMP&#32;&#32;&#32;&#32;&#32;&#32;&#32;320&#32;&#32;</emphasis><emphasis role="comment">//&#32;HSync-length&#32;(3,81us)</emphasis>
98 <emphasis role="preprocessor">#define&#32;&#32;VGA_TIM2_HTRIGGER_START&#32;&#32;480&#32;&#32;</emphasis><emphasis role="comment">//&#32;HSync+BackPorch&#32;(5,71us)</emphasis>
99 <emphasis role="preprocessor">#define&#32;&#32;VGA_TIM2_DMA_DELAY&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;60&#32;&#32;</emphasis><emphasis role="comment">//&#32;ease&#32;the&#32;delay&#32;when&#32;DMA&#32;START&#32;(Optimization&#32;=&#32;none)</emphasis>
100 <emphasis role="comment">//#define&#32;&#32;VGA_TIM2_DMA_DELAY&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;30&#32;&#32;//&#32;ease&#32;the&#32;delay&#32;when&#32;DMA&#32;START&#32;(Optimization&#32;=&#32;-O1)</emphasis>
101 
102 
103 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
104 <emphasis role="comment">//&#32;VSync-Signal</emphasis>
105 <emphasis role="comment">//&#32;Trigger&#32;&#32;&#32;=&#32;Timer2&#32;Update&#32;(f=31,48kHz&#32;=&gt;&#32;T&#32;=&#32;31,76us)</emphasis>
106 <emphasis role="comment">//&#32;1TIC&#32;&#32;&#32;&#32;&#32;&#32;=&#32;31,76us</emphasis>
107 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
108 <emphasis role="preprocessor">#define&#32;&#32;VGA_VSYNC_PERIODE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;525</emphasis>
109 <emphasis role="preprocessor">#define&#32;&#32;VGA_VSYNC_IMP&#32;&#32;2</emphasis>
110 <emphasis role="preprocessor">#define&#32;&#32;VGA_VSYNC_BILD_START&#32;&#32;&#32;&#32;&#32;&#32;36</emphasis>
111 <emphasis role="preprocessor">#define&#32;&#32;VGA_VSYNC_BILD_STOP&#32;&#32;&#32;&#32;&#32;&#32;514&#32;&#32;&#32;</emphasis><emphasis role="comment">//&#32;(16,38ms)</emphasis>
112 <emphasis role="preprocessor">#define&#32;RAM_SIZE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(VGA_DISPLAY_X+1)*VGA_DISPLAY_Y</emphasis>
113 
114 
115 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
116 <emphasis role="comment">//&#32;Adress&#32;from&#32;PORTE&#32;(Reg&#32;ODR)&#32;callback&#32;DMA</emphasis>
117 <emphasis role="comment">//&#32;(see&#32;Page&#32;53+204&#32;of&#32;the&#32;Manual)</emphasis>
118 <emphasis role="comment">//</emphasis>
119 <emphasis role="comment">//&#32;Data-Bit0&#32;=&gt;&#32;PE8</emphasis>
120 <emphasis role="comment">//&#32;Data-Bit7&#32;=&gt;&#32;PE15</emphasis>
121 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
122 <emphasis role="preprocessor">#define&#32;VGA_GPIOE_BASE_ADR&#32;&#32;&#32;&#32;&#32;((uint32_t)0x40021000)&#32;</emphasis><emphasis role="comment">//&#32;ADR&#32;from&#32;Port-E</emphasis>
123 <emphasis role="preprocessor">#define&#32;VGA_GPIO_ODR_OFFSET&#32;&#32;&#32;&#32;((uint32_t)0x00000014)&#32;</emphasis><emphasis role="comment">//&#32;ADR&#32;from&#32;Register&#32;ODR</emphasis>
124 <emphasis role="preprocessor">#define&#32;VGA_GPIO_BYTE_OFFSET&#32;&#32;&#32;((uint32_t)0x00000001)&#32;</emphasis><emphasis role="comment">//&#32;Data&#32;for&#32;8bit</emphasis>
125 <emphasis role="preprocessor">#define&#32;VGA_GPIOE_ODR_ADDRESS&#32;&#32;&#32;(VGA_GPIOE_BASE_ADR&#32;|&#32;VGA_GPIO_ODR_OFFSET&#32;|&#32;VGA_GPIO_BYTE_OFFSET)</emphasis>
126 
127 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
128 <emphasis role="comment">//&#32;Define&#32;for&#32;black&#32;on&#32;PE8&#32;-&#32;PE15</emphasis>
129 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
130 <emphasis role="preprocessor">#define&#32;VGA_GPIO_HINIBBLE&#32;&#32;((uint16_t)0xFF00)&#32;</emphasis><emphasis role="comment">//&#32;GPIO_Pin_8&#32;to&#32;GPIO_Pin_15</emphasis>
131 
132 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
133 <emphasis role="comment">//&#32;Global&#32;Function&#32;call</emphasis>
134 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
135 <emphasis role="keywordtype">void</emphasis>&#32;UB_VGA_Screen_Init(<emphasis role="keywordtype">void</emphasis>);
136 <emphasis role="keywordtype">void</emphasis>&#32;UB_VGA_FillScreen(uint8_t&#32;color);
137 <emphasis role="keywordtype">void</emphasis>&#32;UB_VGA_SetPixel(uint16_t&#32;xp,&#32;uint16_t&#32;yp,&#32;uint8_t&#32;color);
138 
139 <emphasis role="comment">//--------------------------------------------------------------</emphasis>
140 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">//&#32;__STM32F4_UB_VGA_SCREEN_H</emphasis>
</programlisting></section>
